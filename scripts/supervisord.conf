# /etc/supervisor/conf.d/supervisord.conf

[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
loglevel=info

[program:vnc]
command=/usr/bin/Xvnc :1 -desktop "Ubuntu自动化平台" -geometry 1360x768 -depth 24 -rfbport 5901 -rfbauth /home/headless/.vncpasswd -auth /home/headless/.Xauthority -SecurityTypes VncAuth -AlwaysShared -AcceptKeyEvents -AcceptPointerEvents -AcceptCutText -SendCutText -localhost no
user=headless
autostart=true
autorestart=true
priority=100
stdout_logfile=/var/log/supervisor/vnc-stdout.log
stderr_logfile=/var/log/supervisor/vnc-stderr.log
environment=HOME="/home/headless",USER="headless",DISPLAY=":1"

[program:xfce]
command=startxfce4
user=headless
autostart=true
autorestart=true
priority=200
stdout_logfile=/var/log/supervisor/xfce-stdout.log
stderr_logfile=/var/log/supervisor/xfce-stderr.log
# 仍然需要这个环境变量，来告诉 xfce 凭证文件的位置
environment=HOME="/home/headless",USER="headless",DISPLAY=":1",XAUTHORITY="/home/headless/.Xauthority"

[program:novnc]
command=/usr/bin/websockify --web=/usr/share/novnc 6901 localhost:5901
user=headless
autostart=true
autorestart=true
priority=300
stdout_logfile=/var/log/supervisor/novnc-stdout.log
stderr_logfile=/var/log/supervisor/novnc-stderr.log

[program:webapp]
# 命令回归到最简单的形式
command=/opt/venv/bin/python3 /app/web-app/app.py
directory=/app/web-app
user=headless
autostart=true
autorestart=true
priority=300
stdout_logfile=/var/log/supervisor/webapp-stdout.log
stderr_logfile=/var/log/supervisor/webapp-stderr.log
environment=HOME="/home/headless",USER="headless"

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
user=root
autostart=true
autorestart=true
priority=400
stdout_logfile=/var/log/supervisor/nginx-stdout.log
stderr_logfile=/var/log/supervisor/nginx-stderr.log

[supervisord]
nodaemon=true
user=root
logfile=/app/logs/supervisord.log
pidfile=/tmp/supervisord.pid

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
stdout_logfile=/app/logs/nginx.log
stderr_logfile=/app/logs/nginx-error.log
user=root
priority=10

[program:vnc]
command=/usr/bin/Xvnc :1 -desktop "Ubuntu自动化平台" -geometry 1360x768 -depth 24 -rfbport 5901 -rfbauth /home/headless/.vncpasswd -auth /home/headless/.Xauthority -SecurityTypes VncAuth -AlwaysShared -AcceptKeyEvents -AcceptPointerEvents -AcceptCutText -SendCutText -localhost no
autostart=true
autorestart=true
stdout_logfile=/app/logs/vnc.log
stderr_logfile=/app/logs/vnc-error.log
user=headless
priority=20

# --- 修改部分 ---
# 不再直接调用 startxfce4，而是执行 VNC 的启动脚本
[program:xfce]
command=/bin/sh /home/headless/.vnc/xstartup
autostart=true
autorestart=true
stdout_logfile=/app/logs/xfce.log
stderr_logfile=/app/logs/xfce-error.log
user=headless
environment=DISPLAY=":1"
priority=30

[program:novnc]
command=/usr/bin/websockify --web=/usr/share/novnc 6901 localhost:5901
autostart=true
autorestart=true
stdout_logfile=/app/logs/novnc.log
stderr_logfile=/app/logs/novnc-error.log
user=headless
priority=40

[program:webapp]
command=/opt/venv/bin/gunicorn --workers 4 --bind 0.0.0.0:8000 "app:app"
directory=/app/web-app
autostart=true
autorestart=true
stdout_logfile=/app/logs/webapp.log
stderr_logfile=/app/logs/webapp-error.log
user=headless
priority=50

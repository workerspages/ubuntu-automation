# docker-compose.yml

version: '3.8'

services:
  ubuntu-automation:
    image: ghcr.io/workerspages/ubuntu-automation:latest
    container_name: ubuntu-automation
    user: "${UID:-1001}:${GID:-1001}"
    hostname: automation-server
    environment:
      # VNC密码
      - VNC_PW=vncpassword

      # Web应用和 Telegram 配置
      - SECRET_KEY=your-secret-key-here
      - ADMIN_USERNAME=admin
      - ADMIN_PASSWORD=vncpassword
      - TELEGRAM_BOT_TOKEN=YOUR_TELEGRAM_BOT_TOKEN
      - TELEGRAM_CHAT_ID=YOUR_TELEGRAM_CHAT_ID
      
      # GUI 显示环境变量
      - DISPLAY=:1

    volumes:
      - ./data:/app/data
      - ./Downloads:/home/headless/Downloads
      - ./firefox-profile:/home/headless/.mozilla
      - ./scripts:/app/scripts
    restart: unless-stopped
    shm_size: '2gb'

  nginx-proxy:
    image: nginx:1.25-alpine
    container_name: automation-proxy
    ports:
      # 对外只暴露这一个端口，作为统一入口
      - "8080:80"
    volumes:
      # 将我们创建的 Nginx 配置挂载到容器中
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - ubuntu-automation # 确保先启动主服务
    restart: unless-stopped

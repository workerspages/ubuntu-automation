version: '3.8'

services:
  ubuntu-automation:
    # 修改镜像名称(根据您的构建设置)
    image: ghcr.io/workerspages/ubuntu-automation:latest
    # 或使用本地构建
    # build:
    #   context: .
    #   dockerfile: Dockerfile
    container_name: ubuntu-automation
    ports:
      - "5000:5000"
    environment:
      - VNC_PW=admin
      - SECRET_KEY=your-secret-key-change-this
      - ADMIN_USERNAME=admin
      - ADMIN_PASSWORD=admin123
      - TELEGRAM_BOT_TOKEN=
      - TELEGRAM_CHAT_ID=
      - ENABLE_CLOUDFLARE_TUNNEL=false
      - CLOUDFLARE_TUNNEL_TOKEN=
      - DISPLAY=:1
    volumes:
      - ./Downloads:/home/headless/Downloads
      - ./data:/app/data  # 持久化数据库
      - ./logs:/app/logs  # 持久化日志
    restart: unless-stopped
    shm_size: '2gb'
    # 添加健康检查
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
